{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock title %}</title>
    <link rel="icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/language.css' %}">
    <link rel="stylesheet" href="{% static 'css/chatbot.css' %}">
</head>
<body>
    <div class="wrapper">
        <header class="header sticky-top">
            <div class="header-container d-flex">

              <button class="burger-menu d-md-none" type="button" aria-label="Toggle navigation" onclick="toggleMenu()">
                &#9776;
              </button>
          
              <nav class="header-nav pt-4 d-none d-md-block">
                <ul class="header-list d-flex">
                  <li>
                    <a href="/" class="nav-a m-3">{% trans "–ù–∞ –≥–ª–∞–≤–Ω—É—é" %}</a>
                  </li>
                  <li>
                    <a href="/shop" class="nav-a m-3">{% trans "–ú–∞–≥–∞–∑–∏–Ω" %}</a>
                  </li>
                  <li>
                    <a href="{% url 'services:service_list' %}" class="nav-a m-3">{% trans "–£—Å–ª—É–≥–∏" %}</a>
                  </li>
                  <li>
                    <a href="{% url 'auction:list' %}" class="nav-a m-3" onclick="if (!{{ user.is_authenticated|yesno:'true,false' }}) { showAuthModal(); return false; }">
                      {% trans "–ê—É–∫—Ü–∏–æ–Ω" %}
                    </a>
                  </li>
                </ul>
              </nav>
          
              <div class="header-logo d-none d-md-block">
                <a href="/shop"><img src="{% static 'img/logo.png' %}" alt="" class="oreol-logo"></a>
              </div>
          
              <div class="language-switcher d-none d-md-block">
                <form action="{% url 'set_language' %}" method="post">
                  {% csrf_token %}
                  <select name="language" class="language-select" onchange="this.form.submit()">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% get_available_languages as LANGUAGES %}
                    {% for lang_code, lang_name in LANGUAGES %}
                    <option value="{{ lang_code }}" {% if lang_code == LANGUAGE_CODE %}selected{% endif %}
                            data-flag="{% static 'img/flags/'|add:lang_code|add:'.png' %}">
                      {{ lang_name }}
                    </option>
                    {% endfor %}
                  </select>
                </form>
              </div>
          
              <div id="mobileMenu" class="mobile-menu d-md-none">
                <ul class="header-list">
                  <li>
                    <a href="/" class="nav-a m-3">{% trans "–ù–∞ –≥–ª–∞–≤–Ω—É—é" %}</a>
                  </li>
                  <li>
                    <a href="/shop" class="nav-a m-3">{% trans "–ú–∞–≥–∞–∑–∏–Ω" %}</a>
                  </li>
                  <li>
                    <a href="{% url 'services:service_list' %}" class="nav-a m-3">{% trans "–£—Å–ª—É–≥–∏" %}</a>
                  </li>
                  <li>
                    <a href="{% url 'auction:list' %}" class="nav-a m-3" onclick="if (!{{ user.is_authenticated|yesno:'true,false' }}) { showAuthModal(); return false; }">
                      {% trans "–ê—É–∫—Ü–∏–æ–Ω" %}
                    </a>
                  </li>
                  <li>
                    <form action="{% url 'set_language' %}" method="post">
                      {% csrf_token %}
                      <select name="language" class="language-select" onchange="this.form.submit()">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% get_available_languages as LANGUAGES %}
                        {% for lang_code, lang_name in LANGUAGES %}
                        <option value="{{ lang_code }}" {% if lang_code == LANGUAGE_CODE %}selected{% endif %}
                                data-flag="{% static 'img/flags/'|add:lang_code|add:'.png' %}">
                          {{ lang_name }}
                        </option>
                        {% endfor %}
                      </select>
                    </form>
                  </li>
                </ul>
              </div>
              <div class="header-profile pt-2">
                <a href="{% url 'cart:cart_detail' %}">
                  <img src="{% static 'img/cart-img.png' %}" class="cart-img-228" alt="">
                </a>

                {% if user.is_authenticated %}
                <div class="navbar-favorites">
                    <a href="{% url 'favorites:favorites_list' %}">
                        <i class="fa fa-star" aria-hidden="true"></i>
                        {% with fav_count=user.favorites.count %}
                            <span class="fav-count">{{ fav_count }}</span>
                        {% endwith %}
                    </a>
                </div>
                {% endif %}
          
                {% if user.is_authenticated %}
                  <div class="dropdown profile-dropdown d-none d-md-inline">
                    <button class="btn profile-btn dropdown-toggle" type="button"
                            id="profileDropdown"
                            data-bs-toggle="dropdown"
                            aria-expanded="false">
                      {% trans "–ü—Ä–æ—Ñ–∏–ª—å" %}

                    </button>
                    <ul class="dropdown-menu" aria-labelledby="profileDropdown">
                      <li><a class="dropdown-item" href="{% url 'users:profile' %}">{% trans "–õ–∏—á–Ω—ã–π –ö–∞–±–∏–Ω–µ—Ç" %}</a></li>
                      <li><a class="dropdown-item" href="{% url 'users:car_data' %}">{% trans "–î–∞–Ω–Ω—ã–µ –æ–± –ê–≤—Ç–æ" %}</a></li>
                      <li><a class="dropdown-item" href="{% url 'users:orders_history' %}">{% trans "–ò—Å—Ç–æ—Ä–∏—è –ó–∞–∫–∞–∑–æ–≤" %}</a></li>
                      <li><a class="dropdown-item" href="{% url 'services:client_appointments' %}">{% trans "–ú–æ–∏ –£—Å–ª—É–≥–∏" %}</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="{% url 'users:logout' %}">{% trans "–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞" %}</a></li>
                    </ul>
                  </div>
          
                  <button class="btn profile-btn d-md-none"
                          type="button"
                          data-bs-toggle="offcanvas"
                          data-bs-target="#offcanvasProfile"
                          aria-controls="offcanvasProfile">
                    {% trans "–ü—Ä–æ—Ñ–∏–ª—å" %}
                  </button>
          
                  <div class="offcanvas offcanvas-end d-md-none" tabindex="-1" id="offcanvasProfile" aria-labelledby="offcanvasProfileLabel">
                    <div class="offcanvas-header">
                      <h5 class="offcanvas-title" id="offcanvasProfileLabel">{% trans "–ü—Ä–æ—Ñ–∏–ª—å" %}</h5>
                      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                      <ul class="list-unstyled">
                        <li><a href="{% url 'users:profile' %}" class="nav-link">{% trans "–õ–∏—á–Ω—ã–π –ö–∞–±–∏–Ω–µ—Ç" %}</a></li>
                        <li><a href="{% url 'users:car_data' %}" class="nav-link">{% trans "–î–∞–Ω–Ω—ã–µ –æ–± –ê–≤—Ç–æ" %}</a></li>
                        <li><a href="{% url 'users:orders_history' %}" class="nav-link">{% trans "–ò—Å—Ç–æ—Ä–∏—è –ó–∞–∫–∞–∑–æ–≤" %}</a></li>
                        <li><a href="{% url 'services:client_appointments' %}" class="nav-link">{% trans "–ú–æ–∏ –£—Å–ª—É–≥–∏" %}</a></li>
                        <hr>
                        <li><a href="{% url 'users:logout' %}" class="nav-link">{% trans "–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞" %}</a></li>
                      </ul>
                    </div>
                  </div>
                {% else %}
                  <a href="{% url 'users:login' %}" class="m-2">{% trans "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–í—Ö–æ–¥" %}</a>
                {% endif %}
          
                <p class="cart-quantity">
                  {% with cart_quantity=cart|length %}
                    {% if cart_quantity > 0 %}
                      {{ cart_quantity }}
                    {% else %}
                      0
                    {% endif %}
                  {% endwith %}
                </p>
              </div>
            </div>
          </header>
          

    <main class="container">
        {% block content %}
        {% endblock content %}
    </main>
    
    <div class="chat-container" id="chatContainer">
      <button class="chat-button" onclick="toggleChat()">ü§ñ</button>
      <div class="chat-window" id="chatWindow">
        <div class="card shadow-sm">
          <div class="card-header">
            <h5 class="mb-0">–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</h5>
            <button id="clear-chat" class="btn btn-sm btn-light text-dark">–û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
          <div class="card-body" id="chat-box">
          </div>
          <form id="chat-form" class="card-footer">
            <div class="input-group">
              <input type="text" id="user-message" class="form-control" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å..." required>
              <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    

    <footer class="footer fade-in">
        <div class="footer-container">
            <div class="contact-info">
                <h3>{% trans "–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏" %}</h3>
                <p><strong>{% trans "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" %}:</strong> <a href="tel:+77785514008">+7 (778) 551-40-08</a></p>
                <p><strong>{% trans "–¢–µ—Ö. –ø–æ–¥–¥–µ—Ä–∂–∫–∞" %}:</strong> <a href="mailto:oreol.kz@mail.ru">oreol.kz@mail.ru</a></p>
                <p class="developers" strong>{% trans "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏" %}:</strong> Mussin Dilshat & Berikov Danial</p>
            </div>

            <div class="footer-map">
                <div id="map" class="map"></div>
            </div>  

            <div class="socials">
                <h3>{% trans "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏" %}</h3>
                <div class="social-icons">
                    <a href="https://wa.me/77785514008" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://t.me/dilsha04" target="_blank"><i class="fab fa-telegram"></i></a>
                    <a href="https://instagram.com/d_mussin" target="_blank"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>

        <div class="footer-links">
            <a href="/">{% trans "–ù–∞ –≥–ª–∞–≤–Ω—É—é" %}</a>
            <a href="/" id="about-link">{% trans "–û –Ω–∞—Å" %}</a>
            <a href="{% url 'services:service_list' %}">{% trans "–£—Å–ª—É–≥–∏" %}</a>
            <a href="{% url 'reviews:all_reviews' %}">{% trans "–û—Ç–∑—ã–≤—ã" %}</a>
            <a href="/">{% trans "–ö–æ–Ω—Ç–∞–∫—Ç—ã" %}</a>
        </div>

        <button id="scrollTop">‚Üë {% trans "–ù–∞–≤–µ—Ä—Ö" %}</button>

        <div class="footer-bottom">
            <p>¬© <span class="footer-year" id="year"></span> {% trans "–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã" %} | {% trans "–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –û—Ä–µ–æ–ª" %}</p>
        </div>  
    </footer>
    <div class="modal fade" id="authModal" data-bs-backdrop="false" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content auth-modal-content">
          <div class="modal-header auth-modal-header">
            <h5 class="modal-title auth-modal-title" id="authModalLabel">{% trans "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω" %}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans '–ó–∞–∫—Ä—ã—Ç—å' %}"></button>
          </div>
          <div class="modal-body auth-modal-body">
            {% trans "–ß—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è." %}
          </div>
          <div class="modal-footer auth-modal-footer">
            <a href="{% url 'users:login' %}?next={{ request.path }}" class="btn auth-btn auth-btn-primary">
              {% trans "–í–æ–π—Ç–∏" %}
            </a>
            <button type="button" class="btn auth-btn auth-btn-secondary" data-bs-dismiss="modal">
              {% trans "–û—Ç–º–µ–Ω–∞" %}
            </button>
          </div>
        </div>
      </div>
    </div>
    
    </div>

    <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/language.js' %}" defer></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
    <script src="{% static 'js/map.js' %}"></script>
    <script src="{% static 'js/footer.js' %}"></script>
    <script src="{% static 'js/chatbot.js' %}"></script>
    <script>
        function toggleMenu() {
          var menu = document.getElementById("mobileMenu");
          menu.classList.toggle("open");
        }

        function showAuthModal() {
          var authModalEl = document.getElementById('authModal');
          if (authModalEl) {
              var authModal = new bootstrap.Modal(authModalEl);
              authModal.show();
          }
      }
    </script>
    <script>
      window.CHATBOT_API_URL = "{% url 'chatbot:chat' %}";
      window.CHATBOT_URL = "{% url 'chatbot:chat' %}";
      window.CHATBOT_HISTORY_URL = "{% url 'chatbot:chat_history' %}";
      window.CHATBOT_CLEAR_URL = "{% url 'chatbot:clear_history' %}";
    </script>
    {% block extra_css %}{% endblock extra_css %}
    {% block extra_js %}{% endblock extra_js %}
</body>
</html>
